<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
  <div class="container">
    <h2>Cadastro</h2>
    <form id="form-cadastro">
      <input type="text" id="nome" placeholder="Nome Completo" required />
      <input type="text" id="cpf" placeholder="CPF (somente números)" required maxlength="11" inputmode="numeric" />
      <input type="text" id="whatsapp" placeholder="WhatsApp (DDD + número)" required maxlength="11" inputmode="numeric" />
      <input type="email" id="email" placeholder="E-mail" required />
      <input type="password" id="senha" placeholder="Senha" required />
      <input type="password" id="confirmar-senha" placeholder="Confirme sua Senha" required />
      <span id="erro-senha" style="color: red; font-size: 14px;"></span>
      <button type="submit">Cadastrar</button>
    </form>
    <p>Já tem conta? <a href="login.html" style="color: orange;">Faça o login</a></p>
  </div>

  <script>
    // Nome: só letras e espaços
    const inputNome = document.getElementById('nome');
    inputNome.addEventListener('input', function () {
      this.value = this.value.replace(/[^A-Za-zÀ-ú\s]/g, '');
    });

    // CPF: só números
    const inputCpf = document.getElementById('cpf');
    inputCpf.addEventListener('input', function () {
      this.value = this.value.replace(/[^0-9]/g, '');
    });

    // WhatsApp: só números
    const inputWhatsapp = document.getElementById('whatsapp');
    inputWhatsapp.addEventListener('input', function () {
      this.value = this.value.replace(/[^0-9]/g, '');
    });

    document.getElementById('form-cadastro').addEventListener('submit', function(e) {
      e.preventDefault();

      const nome = document.getElementById('nome').value.trim();
      const cpf = document.getElementById('cpf').value.trim();
      const whatsapp = document.getElementById('whatsapp').value.trim();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const senha = document.getElementById('senha').value;
      const confirmarSenha = document.getElementById('confirmar-senha').value;
      const erroSenha = document.getElementById('erro-senha');

      erroSenha.textContent = ''; // limpa mensagem de erro

      // Verifica campos vazios
      if (!nome || !cpf || !whatsapp || !email || !senha || !confirmarSenha) {
        alert('Por favor, preencha todos os campos!');
        return;
      }

      // Validação do nome
      if (nome.split(' ').filter(p => p.length > 0).length < 2) {
        alert('Informe o nome completo (nome e sobrenome).');
        return;
      }

      // Validação do CPF
      if (!/^\d{11}$/.test(cpf)) {
        alert('CPF inválido! Digite apenas números (11 dígitos).');
        return;
      }

      // Validação do WhatsApp
      if (!/^\d{11}$/.test(whatsapp)) {
        alert('Número de WhatsApp inválido! Use o formato DDD + número (11 dígitos).');
        return;
      }

      // Validação da senha
      let errosSenha = [];
      if (senha.length < 5 || senha.length > 9) {
        errosSenha.push('A senha deve ter entre 5 e 9 caracteres.');
      }
      if (!/[A-Z]/.test(senha)) {
        errosSenha.push('Senha deve conter pelo menos uma letra maiúscula.');
      }
      if (!/[a-z]/.test(senha)) {
        errosSenha.push('Senha deve conter pelo menos uma letra minúscula.');
      }
      if (!/[0-9]/.test(senha)) {
        errosSenha.push('Senha deve conter pelo menos um número.');
      }
      if (!/[!@#$%^&*(),.?":{}|<>]/.test(senha)) {
        errosSenha.push('Senha deve conter pelo menos um caractere especial.');
      }

      if (errosSenha.length > 0) {
        erroSenha.textContent = errosSenha.join(' ');
        return;
      }

      // Confirmação de senha
      if (senha !== confirmarSenha) {
        erroSenha.textContent = 'As senhas não coincidem!';
        return;
      }

      // Pega usuários cadastrados
      let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];

      // Verifica duplicidade de email
      if (usuarios.some(usuario => usuario.email === email)) {
        alert('Este e-mail já está cadastrado!');
        return;
      }

      // Verifica duplicidade de CPF
      if (usuarios.some(usuario => usuario.cpf === cpf)) {
        alert('Este CPF já está cadastrado!');
        return;
      }

      // Salva novo usuário
      usuarios.push({ nome, cpf, whatsapp, email, senha });
      localStorage.setItem('usuarios', JSON.stringify(usuarios));

      alert('Cadastro realizado com sucesso! Agora faça o login.');
      window.location.href = 'login.html';
    });
  </script>
</body>
</html>
