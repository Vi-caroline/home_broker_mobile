<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
  <div class="container">
    <h2>Cadastro</h2>
    <form id="form-cadastro">
      <input type="text" id="nome" placeholder="Nome Completo" required />
      <input type="text" id="cpf" placeholder="CPF (somente números)" required maxlength="11" inputmode="numeric" pattern="\d*" />
      <input type="text" id="whatsapp" placeholder="WhatsApp (DDD + número)" required maxlength="11" />
      <input type="email" id="email" placeholder="E-mail" required />
      <input type="password" id="senha" placeholder="Senha" required />
      <input type="password" id="confirmar-senha" placeholder="Confirme sua Senha" required />
      <span id="erro-senha" style="color: red; font-size: 14px;"></span>
      <button type="submit">Cadastrar</button>
    </form>
    <p>Já tem conta? <a href="login.html" style="color: orange;">Faça o login</a></p>
  </div>

  <script>
    // Bloqueia letras no campo CPF
    const inputCpf = document.getElementById('cpf');
    inputCpf.addEventListener('keypress', function(e) {
      const charCode = e.charCode || e.keyCode;
      if (charCode < 48 || charCode > 57) {
        e.preventDefault();
      }
    });

    document.getElementById('form-cadastro').addEventListener('submit', function(e) {
      e.preventDefault();

      const nome = document.getElementById('nome').value.trim();
      const cpf = document.getElementById('cpf').value.trim();
      const whatsapp = document.getElementById('whatsapp').value.trim();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const senha = document.getElementById('senha').value;
      const confirmarSenha = document.getElementById('confirmar-senha').value;
      const erroSenha = document.getElementById('erro-senha');

      erroSenha.textContent = ''; // limpa mensagem de erro

      // Verifica campos vazios
      if (!nome || !cpf || !whatsapp || !email || !senha || !confirmarSenha) {
        alert('Por favor, preencha todos os campos!');
        return;
      }

      // Validação do nome
      const nomeValido = /^[A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÊÍÏÓÔÕÖÚÇÑ\s]+$/.test(nome);
      if (!nomeValido) {
        alert('O nome completo deve conter apenas letras e espaços.');
        return;
      }
      if (nome.split(' ').filter(p => p.length > 0).length < 2) {
        alert('Informe o nome completo (nome e sobrenome).');
        return;
      }

      // Validação do CPF
      if (!/^\d{11}$/.test(cpf)) {
        alert('CPF inválido! Digite apenas números (11 dígitos).');
        return;
      }

      // Validação do WhatsApp
      if (!/^\d{11}$/.test(whatsapp)) {
        alert('Número de WhatsApp inválido! Use o formato DDD + número (11 dígitos).');
        return;
      }

      // Validação da senha
      if (senha.length !== 9) {
        alert('A senha deve ter exatamente 9 caracteres.');
        return;
      }
      if (!/[A-Z]/.test(senha)) {
        alert('A senha deve conter pelo menos uma letra maiúscula.');
        return;
      }
      if (!/[a-z]/.test(senha)) {
        alert('A senha deve conter pelo menos uma letra minúscula.');
        return;
      }
      if (!/[0-9]/.test(senha)) {
        alert('A senha deve conter pelo menos um número.');
        return;
      }
      if (!/[!@#$%^&*(),.?":{}|<>]/.test(senha)) {
        alert('A senha deve conter pelo menos um caractere especial.');
        return;
      }

      // Confirmação de senha (mensagem na tela)
      if (senha !== confirmarSenha) {
        erroSenha.textContent = 'As senhas não coincidem!';
        return;
      }

      // Pega usuários cadastrados
      let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];

      // Verifica duplicidade de email
      if (usuarios.some(usuario => usuario.email === email)) {
        alert('Este e-mail já está cadastrado!');
        return;
      }

      // Verifica duplicidade de CPF
      if (usuarios.some(usuario => usuario.cpf === cpf)) {
        alert('Este CPF já está cadastrado!');
        return;
      }

      // Salva novo usuário
      usuarios.push({ nome, cpf, whatsapp, email, senha });
      localStorage.setItem('usuarios', JSON.stringify(usuarios));

      alert('Cadastro realizado com sucesso! Agora faça o login.');
      window.location.href = 'login.html';
    });
  </script>
</body>
</html>
